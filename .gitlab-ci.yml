image: maven:3.5.0-jdk-8-alpine

variables:
  MAVEN_OPTS: ""
  MAVEN_CLI_OPTS: "--batch-mode --errors --fail-at-end --show-version -DinstallAtEnd=true -DdeployAtEnd=true -Dmaven.repo.local=$CI_PROJECT_DIR/.cached/.m2/repository/"

cache:
  key: m2_repository
  paths:
    - "$CI_PROJECT_DIR/.cached/.m2/repository/"

main_build:
  stage: build
  script: 
    - "echo Current build id: $CI_COMMIT_SHA"
    - "export MAVEN_OPTS MAVEN_CLI_OPTS"
    - "mvn $MAVEN_CLI_OPTS help:evaluate -Dexpression=settings.localRepository | grep -v '\\[INFO\\]'"
    - "chmod +x build-default.sh && ./build-default.sh"
